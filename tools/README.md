# Tools ç›®éŒ„

æ­¤ç›®éŒ„åŒ…å«å®Œæ•´çš„å…©éšæ®µå•†å“åŒ¹é…ç³»çµ±çš„æ‰€æœ‰å·¥å…·ï¼ŒæŒ‰åŠŸèƒ½åˆ†é¡çµ„ç¹”ã€‚

## ç›®éŒ„çµæ§‹

```
tools/
â”œâ”€â”€ data_processing/           # è³‡æ–™è™•ç†å·¥å…·
â”‚   â”œâ”€â”€ simple_correct_parser.py
â”‚   â”œâ”€â”€ view_correct_data.py
â”‚   â”œâ”€â”€ mysql_file_reader.py
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ embedding_processors/      # Embedding è™•ç†å™¨
â”‚   â”œâ”€â”€ clip_image_processor.py
â”‚   â”œâ”€â”€ text_embedding_processor.py
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ dataset_generators/        # è³‡æ–™é›†ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ bm25_sampler.py
â”‚   â”œâ”€â”€ classification_dataset_generator.py
â”‚   â”œâ”€â”€ triplet_dataset_generator.py
â”‚   â”œâ”€â”€ generate_training_datasets.py
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ model_training/           # æ¨¡å‹è¨“ç·´
â”‚   â”œâ”€â”€ train_triplet_model.py
â”‚   â”œâ”€â”€ train_classification_model.py
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ model_testing/            # æ¨¡å‹æ¸¬è©¦
â”‚   â”œâ”€â”€ test_models.py
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ pipelines/                # æ•´åˆç®¡é“
â”‚   â”œâ”€â”€ train_and_test_pipeline.py
â”‚   â””â”€â”€ README.md
â””â”€â”€ README.md                 # æœ¬æ–‡ä»¶
```

## å¿«é€Ÿé–‹å§‹

### 1. è³‡æ–™è™•ç†

```bash
cd data_processing
python simple_correct_parser.py
python view_correct_data.py
```

### 2. ç”Ÿæˆè¨“ç·´è³‡æ–™

```bash
cd dataset_generators
python generate_training_datasets.py \
    --leaf_file ../../data/correct_structure_data/leaf_v1_correct.csv \
    --root_file ../../data/correct_structure_data/root_v1_correct.csv \
    --output_dir training_data \
    --k 5 \
    --sample_size 1000 \
    --embedding_dim 512 \
    --use_clip
```

### 3. åŸ·è¡Œå®Œæ•´ç®¡é“

```bash
cd pipelines
python train_and_test_pipeline.py \
    --training_data_dir ../dataset_generators/training_data \
    --output_dir pipeline_results \
    --text_embedding_dim 512 \
    --image_embedding_dim 512 \
    --hidden_dim 256 \
    --output_dim 128 \
    --batch_size 32 \
    --epochs 50 \
    --learning_rate 0.001 \
    --similarity_threshold 0.5
```

## å·¥ä½œæµç¨‹

### éšæ®µ 1: è³‡æ–™æº–å‚™

1. **è³‡æ–™è™•ç†** (`data_processing/`)

   - è§£æ MySQL è³‡æ–™æª”æ¡ˆ
   - æª¢è¦–å’Œé©—è­‰è³‡æ–™çµæ§‹
   - æº–å‚™æ­£ç¢ºæ ¼å¼çš„è³‡æ–™

2. **Embedding ç”Ÿæˆ** (`embedding_processors/`)
   - ç”Ÿæˆæ–‡å­— embedding (BERT/TF-IDF/è‡ªå®šç¾©)
   - ç”Ÿæˆåœ–ç‰‡ embedding (CLIP)
   - æ”¯æ´æ‰¹æ¬¡è™•ç†å’ŒéŒ¯èª¤è™•ç†

### éšæ®µ 2: è³‡æ–™é›†ç”Ÿæˆ

3. **æ¨£æœ¬é¸æ“‡** (`dataset_generators/`)
   - ä½¿ç”¨ BM25 ç®—æ³•é¸æ“‡æ­£è² æ¨£æœ¬
   - ç”Ÿæˆåˆ†é¡è¨“ç·´é›†
   - ç”Ÿæˆ Triplet è¨“ç·´é›†

### éšæ®µ 3: æ¨¡å‹è¨“ç·´

4. **æ¨¡å‹è¨“ç·´** (`model_training/`)
   - è¨“ç·´ Triplet ç›¸ä¼¼åº¦æ¨¡å‹
   - è¨“ç·´åˆ†é¡æ¨¡å‹
   - è‡ªå‹•ä¿å­˜æœ€ä½³æ¨¡å‹

### éšæ®µ 4: æ¨¡å‹æ¸¬è©¦

5. **æ¨¡å‹è©•ä¼°** (`model_testing/`)
   - æ¸¬è©¦å–®å€‹æ¨¡å‹æ€§èƒ½
   - æ¸¬è©¦å…©éšæ®µçµ„åˆæ€§èƒ½
   - ç”Ÿæˆè©³ç´°è©•ä¼°å ±å‘Š

### éšæ®µ 5: æ•´åˆç®¡é“

6. **è‡ªå‹•åŒ–æµç¨‹** (`pipelines/`)
   - è‡ªå‹•åŸ·è¡Œæ‰€æœ‰æ­¥é©Ÿ
   - ç”Ÿæˆå®Œæ•´å ±å‘Š
   - éŒ¯èª¤è™•ç†å’Œæ¢å¾©

## å„æ¨¡çµ„è©³ç´°èªªæ˜

### ğŸ“ data_processing/

- **åŠŸèƒ½**: è™•ç†å’Œè§£æåŸå§‹ MySQL è³‡æ–™
- **ä¸»è¦å·¥å…·**: è³‡æ–™è§£æå™¨ã€æª¢è¦–å™¨ã€æª”æ¡ˆæƒæå™¨
- **è¼¸å‡º**: æ­£ç¢ºçµæ§‹çš„ CSV æª”æ¡ˆ

### ğŸ“ embedding_processors/

- **åŠŸèƒ½**: ç”Ÿæˆæ–‡å­—å’Œåœ–ç‰‡çš„ embedding
- **æ”¯æ´æ–¹æ³•**: BERTã€TF-IDFã€CLIPã€è‡ªå®šç¾©æ¨¡å‹
- **ç‰¹é»**: æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œæ˜“æ–¼æ“´å±•

### ğŸ“ dataset_generators/

- **åŠŸèƒ½**: ç”Ÿæˆæ©Ÿå™¨å­¸ç¿’è¨“ç·´è³‡æ–™é›†
- **è³‡æ–™é¡å‹**: BM25 æ¨£æœ¬ã€åˆ†é¡è³‡æ–™é›†ã€Triplet è³‡æ–™é›†
- **ç‰¹é»**: å¯é…ç½®çš„åƒæ•¸å’Œè‡ªå‹•åŒ–æµç¨‹

### ğŸ“ model_training/

- **åŠŸèƒ½**: è¨“ç·´å…©éšæ®µå•†å“åŒ¹é…æ¨¡å‹
- **æ¨¡å‹é¡å‹**: ç›¸ä¼¼åº¦æ¨¡å‹ã€åˆ†é¡æ¨¡å‹
- **ç‰¹é»**: å®Œæ•´çš„è¨“ç·´ç›£æ§å’Œæª¢æŸ¥é»æ©Ÿåˆ¶

### ğŸ“ model_testing/

- **åŠŸèƒ½**: æ¸¬è©¦å’Œè©•ä¼°æ¨¡å‹æ€§èƒ½
- **è©•ä¼°é¡å‹**: å–®æ¨¡å‹æ¸¬è©¦ã€çµ„åˆæ¨¡å‹æ¸¬è©¦
- **è¼¸å‡º**: è©³ç´°çš„æ€§èƒ½æŒ‡æ¨™å’Œå ±å‘Š

### ğŸ“ pipelines/

- **åŠŸèƒ½**: æ•´åˆæ‰€æœ‰æ­¥é©Ÿçš„è‡ªå‹•åŒ–ç®¡é“
- **ç‰¹é»**: ç«¯åˆ°ç«¯çš„è‡ªå‹•åŒ–æµç¨‹
- **è¼¸å‡º**: å®Œæ•´çš„è¨“ç·´å’Œæ¸¬è©¦å ±å‘Š

## é…ç½®å’Œåƒæ•¸

### é€šç”¨é…ç½®

- **è¨­å‚™**: æ”¯æ´ CPU å’Œ GPU è¨“ç·´
- **æ‰¹æ¬¡å¤§å°**: å¯æ ¹æ“šè¨˜æ†¶é«”èª¿æ•´
- **å­¸ç¿’ç‡**: å¯èª¿æ•´ä»¥å„ªåŒ–è¨“ç·´æ•ˆæœ

### æ¨¡å‹é…ç½®

- **æ–‡å­— embedding ç¶­åº¦**: 512 (BERT) æˆ–è‡ªå®šç¾©
- **åœ–ç‰‡ embedding ç¶­åº¦**: 512 (CLIP)
- **éš±è—å±¤ç¶­åº¦**: 256 (å¯èª¿æ•´)
- **è¼¸å‡ºç¶­åº¦**: 128 (ç›¸ä¼¼åº¦æ¨¡å‹)

### è¨“ç·´é…ç½®

- **è¨“ç·´è¼ªæ•¸**: 50 (å¯èª¿æ•´)
- **é©—è­‰æ¯”ä¾‹**: 20%
- **æ—©åœæ©Ÿåˆ¶**: åŸºæ–¼é©—è­‰æå¤±

## è‡ªå®šç¾©å’Œæ“´å±•

### æ·»åŠ æ–°çš„ Embedding æ–¹æ³•

1. åœ¨ `embedding_processors/` ä¸­å¯¦ç¾æ–°çš„è™•ç†å™¨
2. ç¹¼æ‰¿åŸºé¡ä¸¦å¯¦ç¾å¿…è¦æ–¹æ³•
3. åœ¨å·¥å» å‡½æ•¸ä¸­è¨»å†Šæ–°æ–¹æ³•

### ä¿®æ”¹æ¨¡å‹æ¶æ§‹

1. åœ¨ `model_training/` ä¸­ä¿®æ”¹æ¨¡å‹é¡åˆ¥
2. èª¿æ•´ç¶²è·¯å±¤å’Œåƒæ•¸
3. æ›´æ–°è¨“ç·´é…ç½®

### æ·»åŠ æ–°çš„è©•ä¼°æŒ‡æ¨™

1. åœ¨ `model_testing/` ä¸­å¯¦ç¾æ–°çš„è©•ä¼°é‚è¼¯
2. æ›´æ–°æ¸¬è©¦å ±å‘Šæ ¼å¼
3. æ•´åˆåˆ°ç®¡é“ä¸­

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **è¨˜æ†¶é«”ä¸è¶³**: æ¸›å°‘ batch_size æˆ–ä½¿ç”¨æ›´å°çš„æ¨¡å‹
2. **è¨“ç·´ä¸æ”¶æ–‚**: èª¿æ•´å­¸ç¿’ç‡æˆ–å¢åŠ è¨“ç·´è¼ªæ•¸
3. **æ¨¡å‹è¼‰å…¥å¤±æ•—**: æª¢æŸ¥æ¨¡å‹è·¯å¾‘å’Œæ ¼å¼

### æ€§èƒ½å„ªåŒ–

1. **GPU åŠ é€Ÿ**: ä½¿ç”¨ CUDA è¨­å‚™
2. **æ‰¹æ¬¡è™•ç†**: èª¿æ•´æ‰¹æ¬¡å¤§å°
3. **ä¸¦è¡Œè™•ç†**: ä½¿ç”¨å¤šé€²ç¨‹è™•ç†

## æ³¨æ„äº‹é …

- ç¢ºä¿æ‰€æœ‰ä¾è³´å¥—ä»¶å·²æ­£ç¢ºå®‰è£
- æª¢æŸ¥è¼¸å…¥è³‡æ–™çš„æ ¼å¼å’Œè·¯å¾‘
- æ ¹æ“šç¡¬é«”é…ç½®èª¿æ•´åƒæ•¸
- å®šæœŸå‚™ä»½è¨“ç·´çµæœå’Œæ¨¡å‹

## ç›¸é—œæ–‡æª”

- [è©³ç´°æŠ€è¡“æ–‡æª”](../docs/README.md)
- [è¨“ç·´è³‡æ–™é›†ä½¿ç”¨æŒ‡å—](../docs/training_dataset_guide.md)
- [å…©éšæ®µæ¨¡å‹ä½¿ç”¨æŒ‡å—](../docs/two_stage_model_guide.md)
